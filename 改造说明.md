### ä»»åŠ¡èƒŒæ™¯

MiroThinkeræ˜¯ä¸€ä¸ªå€ŸåŠ©AIå®ç°ä¿¡æ¯æœç´¢æ•´ç†çš„Githubé¡¹ç›®ï¼Œåœ°å€æ˜¯ï¼šhttps://github.com/RickNote/MiroThinker ï¼Œæˆ‘å·²ç»Forkåˆ°æœ¬åœ°æ–‡ä»¶å¤¹ï¼Œæˆ‘å¸Œæœ›æŠŠè¿™ä¸ªé¡¹ç›®å°è£…æˆä¸€ä¸ªMCPæœåŠ¡ï¼Œå¹¶éƒ¨ç½²åœ¨RailwayæœåŠ¡å™¨ä¸Šã€‚

### ä»»åŠ¡æ„æƒ³

åœ¨ Railway ä¸Šåªéƒ¨ç½²MiroThinkerçš„ã€Œå·¥å…·å±‚ / MCP æœåŠ¡å™¨ã€ï¼Œ
çœŸæ­£çš„å¤§æ¨¡å‹æ¨ç†äº¤ç»™ç¬¬ä¸‰æ–¹ APIï¼ˆæ¯”å¦‚ OpenAIã€Anthropicæˆ–è€…DeepSeekç­‰ç¬¬ä¸‰æ–¹å¤§æ¨¡å‹APIï¼‰ï¼Œè€Œä¸æ˜¯åœ¨æœ¬åœ°æˆ– Railway è‡ªå·±éƒ¨ç½²å¤§æ¨¡å‹ã€‚

### ä»»åŠ¡éœ€æ±‚

è¯·å‚è€ƒæˆ‘çš„éœ€æ±‚å¯¹é¡¹ç›®è¿›è¡Œæ”¹é€ ï¼Œè¯·å…ˆå‡ºå…·æ”¹é€ æ–¹æ¡ˆï¼Œå¦‚æœä½ æœ‰ä¸ç¡®å®šæˆ–è€…ä¸ç†è§£çš„éƒ¨åˆ†ï¼Œè¯·éšæ—¶åœä¸‹æ¥å‘æˆ‘æé—®ï¼Œç­‰æˆ‘ç¡®å®šåæˆ‘ä»¬å†ç»§ç»­ã€‚

# MiroThinker MCP æœåŠ¡ â€” å®Œæ•´æ”¹é€ æ–¹æ¡ˆï¼ˆåŸºäºæºç åˆ†æç»ˆç‰ˆï¼‰

---

## ä¸€ã€æºç åˆ†æå…³é”®å‘ç°

åœ¨æ­£å¼è¾“å‡ºæ–¹æ¡ˆä¹‹å‰ï¼Œå…ˆæ€»ç»“ä» 8 ä¸ªæºæ–‡ä»¶ä¸­æå–çš„å…³é”®å®ç°ç»†èŠ‚ï¼Œè¿™äº›ç›´æ¥å½±å“æˆ‘ä»¬çš„ä»£ç ç¼–å†™ï¼š

### å‘ç° 1ï¼šSerper API è°ƒç”¨ç»†èŠ‚

```
ç«¯ç‚¹: POST {SERPER_BASE_URL}/search   ï¼ˆæ³¨æ„ï¼šåªæœ‰ /search ä¸€ä¸ªç«¯ç‚¹ï¼Œæ²¡æœ‰ /news /imagesï¼‰
è¯·æ±‚å¤´: X-API-KEY + Content-Type: application/json
è¯·æ±‚ä½“: { q, gl, hl, location, num, tbs, page, autocorrect }
è¿”å›: { organic: [{title, link, snippet, position, ...}], searchParameters: {...} }

é‡è¦è¡Œä¸º:
  â‘  è¿‡æ»¤æ‰ HuggingFace dataset/space çš„ URLï¼ˆé˜²æ­¢æ•°æ®æ³„æ¼ï¼‰
  â‘¡ å¦‚æœæ— ç»“æœä¸”æœç´¢è¯å¸¦å¼•å·ï¼Œè‡ªåŠ¨å»å¼•å·é‡è¯•
  â‘¢ è¿”å›ç»“æœä¸­çš„ URL éœ€è¦åš decodeï¼ˆurl_unquoteï¼‰
  â‘£ é‡è¯•ç­–ç•¥: 3 æ¬¡, æŒ‡æ•°é€€é¿(4s-10s)
```

### å‘ç° 2ï¼šJina æŠ“å–ç»†èŠ‚

```
ç«¯ç‚¹: GET {JINA_BASE_URL}/{url}
è¯·æ±‚å¤´: Authorization: Bearer {JINA_API_KEY}  ï¼ˆæ²¡æœ‰ Accept å’Œ X-No-Cache å¤´ï¼ï¼‰
æœ€å¤§å­—ç¬¦: 409600 (102400 * 4)
è¶…æ—¶: connect=20s, read=60s
é‡è¯•: [1, 2, 4, 8] ç§’é—´éš”

é‡è¦è¡Œä¸º:
  â‘  Jina å¤±è´¥åæœ‰ Python ç›´æ¥æŠ“å–çš„ fallbackï¼ˆç”¨ httpx ç›´æ¥ GET ç›®æ ‡ URLï¼‰
  â‘¡ éœ€è¦æ£€æµ‹ InsufficientBalanceErrorï¼ˆJina ä½™é¢ä¸è¶³çš„ç‰¹æ®Šå“åº”ï¼‰
  â‘¢ éœ€è¦é¿å…é‡å¤çš„ Jina URL å‰ç¼€ï¼ˆå¦‚æœ url å·²ç»åŒ…å« https://r.jina.ai/ï¼‰
```

### å‘ç° 3ï¼šLLM æ‘˜è¦è°ƒç”¨ç»†èŠ‚

```
å…³é”®å‘ç°: SUMMARY_LLM_BASE_URL æ˜¯å®Œæ•´çš„ chat completions ç«¯ç‚¹ URL
  ä¾‹å¦‚: "https://your_url/v1/chat/completions"
  è€Œä¸æ˜¯ OpenAI SDK æœŸæœ›çš„ base_urlï¼ˆå¦‚ "https://api.xxx.com/v1"ï¼‰

åŸé¡¹ç›®ä½¿ç”¨: httpx ç›´æ¥ POST åˆ°å®Œæ•´ URLï¼Œè€Œé OpenAI SDK
æå–ä¿¡æ¯çš„ Prompt: EXTRACT_INFO_PROMPTï¼ˆèšç„¦æå–ï¼Œè€Œéé€šç”¨æ€»ç»“ï¼‰
è¶…æ—¶: connect=30s, read=300sï¼ˆ5åˆ†é’Ÿï¼LLM ç”Ÿæˆå¯èƒ½å¾ˆæ…¢ï¼‰
é‡è¯•: [1, 2, 4, 8] ç§’
ç‰¹æ®Šå¤„ç†:
  â‘  æ£€æµ‹ä¸Šä¸‹æ–‡é•¿åº¦è¶…é™ â†’ ä»å°¾éƒ¨æˆªæ–­å†…å®¹åé‡è¯•
  â‘¡ æ£€æµ‹é‡å¤è¾“å‡ºï¼ˆå°¾éƒ¨50å­—ç¬¦å‡ºç°>5æ¬¡ï¼‰â†’ é‡è¯•
  â‘¢ GPT-5 ç‰¹æ®Šå‚æ•°å¤„ç†ï¼ˆservice_tier, reasoning_effortï¼‰
```

### å‘ç° 4ï¼šLLM Client è®¾è®¡æ¨¡å¼

```
åŸé¡¹ç›®çš„ OpenAI Client ç‰¹ç‚¹:
  â‘  æœ€å¤šé‡è¯• 10 æ¬¡ï¼Œæ¯æ¬¡ç­‰ 30 ç§’
  â‘¡ é‡åˆ° finish_reason="length" â†’ å¢å¤§ max_tokens 10% åé‡è¯•
  â‘¢ æ£€æµ‹ä¸¥é‡é‡å¤ï¼ˆå°¾éƒ¨50å­—ç¬¦å‡ºç°>5æ¬¡ï¼‰â†’ é‡è¯•
  â‘£ DeepSeek v3.1 ç‰¹æ®Šå¤„ç†ï¼ˆæ·»åŠ  thinking å‚æ•°ï¼‰
  â‘¤ ä½¿ç”¨ httpx ä½œä¸ºåº•å±‚ HTTP å®¢æˆ·ç«¯ï¼ˆä¸æ˜¯ aiohttpï¼‰
```

### å‘ç° 5ï¼šä¾èµ–é€‰æ‹©

```
åŸé¡¹ç›®ç»Ÿä¸€ä½¿ç”¨ httpxï¼ˆä¸æ˜¯ aiohttpï¼‰:
  - Serper API è°ƒç”¨: httpx.AsyncClient
  - Jina æŠ“å–: httpx.AsyncClient
  - LLM Summary è°ƒç”¨: httpx.AsyncClient
  - OpenAI SDK å†…éƒ¨ä¹Ÿç”¨ httpx

ç»“è®º: æˆ‘ä»¬åº”è¯¥ç”¨ httpx æ›¿ä»£åŸæ–¹æ¡ˆä¸­çš„ aiohttp
```

---

## äºŒã€é¡¹ç›®å®šä½ï¼ˆä¸å˜ï¼‰

å°† MiroThinker çš„ä¿¡æ¯æœç´¢æ•´ç†èƒ½åŠ›å°è£…æˆ MCP å·¥å…·æœåŠ¡ï¼Œéƒ¨ç½²åœ¨ Railway ä¸Šï¼Œä½œä¸º Claude çš„"æŸ¥èµ„æ–™"èƒ½åŠ›æ‰©å±•ã€‚æ‰€æœ‰å·¥å…·ä»¥ `miro_` ä¸ºå‰ç¼€ï¼Œä¸ Claudian å†…ç½®å·¥å…·åŒºåˆ†ã€‚

---

## ä¸‰ã€æœ€ç»ˆæ¶æ„ï¼ˆä¸å˜ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Obsidian + Claudian æ’ä»¶                               â”‚
â”‚                                                                  â”‚
â”‚  ç³»ç»Ÿæç¤º: "éœ€è¦æŸ¥èµ„æ–™æ—¶è¯·ä½¿ç”¨ miro_ ç³»åˆ—å·¥å…·ï¼Œ                     â”‚
â”‚            ä¸è¦ä½¿ç”¨å†…ç½®çš„ WebSearch/WebFetch"                      â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Claude (ç¬¬ä¸‰æ–¹ API) â€” æ¨ç†å¼•æ“                            â”‚    â”‚
â”‚  â”‚  ä¸»åŠ¨åˆ¤æ–­éœ€è¦ä»€ä¹ˆä¿¡æ¯ â†’ æŒ‰éœ€è°ƒç”¨ miro_ å·¥å…· â†’ è‡ªå·±ç»„ç»‡å‘ˆç°   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚ Tool Call                       â”‚ Tool Result          â”‚
â”‚           â”‚                                â”‚ + å®æ—¶æ—¥å¿—/è¿›åº¦        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Claudian MCP Client (SSE)                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚  SSE                            â”‚
            â–¼                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Railway æœåŠ¡å™¨                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                MCP Server (FastMCP, SSE)                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”‚
â”‚  â”‚  â”‚miro_search â”‚ â”‚miro_read â”‚ â”‚miro_summarize  â”‚            â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â”‚
â”‚  â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                              â”‚  â”‚
â”‚  â”‚                â”‚miro_researchâ”‚                              â”‚  â”‚
â”‚  â”‚                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                              â”‚  â”‚
â”‚  â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                              â”‚  â”‚
â”‚  â”‚                â”‚ LLM Client  â”‚ â† OpenAI å…¼å®¹æ¥å£            â”‚  â”‚
â”‚  â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼              â–¼              â–¼
        Serper API       Jina API       LLM API
```

---

## å››ã€æ–‡ä»¶ç»“æ„

```text
MiroThinker/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ miroflow-agent/                # åŸæœ‰ä»£ç ï¼ˆå®Œå…¨ä¸åŠ¨ï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ mcp-server/                    # ğŸ†• ç‹¬ç«‹çš„ MCP æœåŠ¡åº”ç”¨
â”‚       â”œâ”€â”€ mcp_server.py              # [æ–‡ä»¶A]  MCP æœåŠ¡å…¥å£ + 4ä¸ªå·¥å…·æ³¨å†Œ
â”‚       â”œâ”€â”€ mcp_config.py              # [æ–‡ä»¶B]  ç¯å¢ƒå˜é‡é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ llm_client.py              # [æ–‡ä»¶C]  LLM ç»Ÿä¸€è°ƒç”¨å±‚ï¼ˆä¸»LLMç”¨OpenAI SDKï¼Œæ‘˜è¦LLMç”¨httpxç›´è¿ï¼‰
â”‚       â”œâ”€â”€ mcp_tools/
â”‚       â”‚   â”œâ”€â”€ __init__.py            # [æ–‡ä»¶D]
â”‚       â”‚   â”œâ”€â”€ miro_search.py         # [æ–‡ä»¶E]  Serper æœç´¢
â”‚       â”‚   â”œâ”€â”€ miro_read.py           # [æ–‡ä»¶F]  Jina æŠ“å– + LLM æå– + Python fallback
â”‚       â”‚   â”œâ”€â”€ miro_summarize.py      # [æ–‡ä»¶G]  LLM æ€»ç»“æ•´ç†
â”‚       â”‚   â”œâ”€â”€ miro_research.py       # [æ–‡ä»¶H]  å¤šè½®ç³»ç»Ÿæ€§ç ”ç©¶
â”‚       â”‚   â””â”€â”€ utils.py               # [æ–‡ä»¶I]  ğŸ†• URLè§£ç ç­‰å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ requirements.txt           # [æ–‡ä»¶J]  ç²¾ç®€ä¾èµ–
â”‚       â”œâ”€â”€ Dockerfile                 # [æ–‡ä»¶K]  Docker æ„å»º
â”‚       â”œâ”€â”€ railway.toml               # [æ–‡ä»¶L]  Railway éƒ¨ç½²é…ç½®
â”‚       â”œâ”€â”€ .env.example               # [æ–‡ä»¶M]  ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚       â””â”€â”€ README.md                  # [æ–‡ä»¶N]  è¯´æ˜æ–‡æ¡£
```

**ç›¸æ¯”ä¹‹å‰çš„æ–¹æ¡ˆå¢åŠ äº† 1 ä¸ªæ–‡ä»¶**ï¼š`mcp_tools/utils.py`ï¼ˆURL è§£ç å·¥å…·å‡½æ•°ï¼Œç§»æ¤è‡ªåŸé¡¹ç›®çš„ `url_unquote.py`ï¼‰

---

## äº”ã€14 ä¸ªæ–‡ä»¶è¯¦ç»†è®¾è®¡

---

### æ–‡ä»¶ Aï¼š`mcp_server.py`

**èŒè´£**ï¼šMCP æœåŠ¡å…¥å£ï¼Œæ³¨å†Œ 4 ä¸ªå·¥å…·ï¼ŒSSE æ¨¡å¼å¯åŠ¨

**æ ¸å¿ƒé€»è¾‘**ï¼š

```
åˆå§‹åŒ–:
  åŠ è½½ .envï¼ˆæœ¬åœ°å¼€å‘ç”¨ï¼‰
  config = Config.from_env()
  llm = LLMClient(config)
  mcp = FastMCP("MiroThinker", instructions=INSTRUCTIONS)

INSTRUCTIONS å†…å®¹:
  """
  MiroThinker æ˜¯ä¸€ç»„ä¿¡æ¯æŸ¥è¯¢ä¸ç ”ç©¶å·¥å…·ã€‚
  å½“ä½ éœ€è¦è·å–æœ€æ–°ä¿¡æ¯ã€æŸ¥è¯äº‹å®ã€æŸ¥æ‰¾æ•°æ®æˆ–ç ”ç©¶æŸä¸ªè¯é¢˜æ—¶ï¼Œ
  è¯·ä½¿ç”¨ä»¥ä¸‹ miro_ ç³»åˆ—å·¥å…·ï¼Œå®ƒä»¬æ¯”å†…ç½®æœç´¢å·¥å…·æ›´ç¨³å®šå¯é ï¼š

  - miro_search: æœç´¢äº’è”ç½‘ï¼ˆæ›¿ä»£å†…ç½® WebSearchï¼‰
  - miro_read: é˜…è¯»ç½‘é¡µå†…å®¹ï¼ˆæ›¿ä»£å†…ç½® WebFetchï¼Œå¸¦æ™ºèƒ½æå–ï¼‰
  - miro_summarize: æ•´ç†å’Œæ€»ç»“å¤§æ®µä¿¡æ¯
  - miro_research: ç³»ç»Ÿæ€§å¤šè½®ç ”ç©¶æŸä¸ªè¯é¢˜

  é‡è¦ï¼šè¯·ä¼˜å…ˆä½¿ç”¨ miro_ ç³»åˆ—å·¥å…·è€Œéå†…ç½®æœç´¢å·¥å…·ã€‚
  å¯¹äºç®€å•çš„äº‹å®æŸ¥è¯¢ï¼Œä¸€æ¬¡ miro_search å¯èƒ½å°±å¤Ÿäº†ï¼›
  éœ€è¦çœ‹ç½‘é¡µè¯¦æƒ…æ—¶è¿½åŠ  miro_readï¼›
  å¤æ‚è¯é¢˜ç”¨ miro_research æˆ–è‡ªå·±å¤šæ¬¡è°ƒç”¨æœç´¢å’Œé˜…è¯»ã€‚
  """

æ³¨å†Œ 4 ä¸ªå·¥å…·:
  æ¯ä¸ª handler æ¥æ”¶ ctx: Context å‚æ•°ç”¨äºæ¨é€æ—¥å¿—å’Œè¿›åº¦
  å†…éƒ¨è°ƒç”¨ mcp_tools/ ä¸­çš„å®ç°å‡½æ•°

å¯åŠ¨:
  mcp.run(transport="sse", host="0.0.0.0", port=config.port)
```

---

### æ–‡ä»¶ Bï¼š`mcp_config.py`

**èŒè´£**ï¼šä»ç¯å¢ƒå˜é‡åŠ è½½é…ç½®

**é…ç½®é¡¹**ï¼ˆåŸºäºæºç åˆ†æçš„ç²¾ç¡®å®šä¹‰ï¼‰ï¼š

```
Config:
  # â€”â€” æœç´¢ â€”â€”
  serper_api_key: str            # å¿…å¡«
  serper_base_url: str           # é»˜è®¤ "https://google.serper.dev"

  # â€”â€” ç½‘é¡µæŠ“å– â€”â€”
  jina_api_key: str              # å¿…å¡«
  jina_base_url: str             # é»˜è®¤ "https://r.jina.ai"

  # â€”â€” ä¸» LLMï¼ˆmiro_research çš„æ¨ç†å¼•æ“ï¼‰â€”â€”
  llm_api_key: str               # å¿…å¡«
  llm_base_url: str              # å¿…å¡«ï¼ŒOpenAI SDK æ ¼å¼ï¼Œå¦‚ "https://api.deepseek.com/v1"
  llm_model: str                 # å¿…å¡«ï¼Œå¦‚ "deepseek-chat"

  # â€”â€” æ‘˜è¦ LLMï¼ˆmiro_read çš„å†…å®¹æå–ï¼‰â€”â€”
  # âš ï¸ å…³é”®å‘ç°ï¼šåŸé¡¹ç›®çš„ SUMMARY_LLM_BASE_URL æ˜¯å®Œæ•´çš„ chat completions ç«¯ç‚¹
  # å¦‚ "https://xxx/v1/chat/completions"
  # æˆ‘ä»¬ä¿æŒå…¼å®¹ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ OpenAI SDK æ ¼å¼
  summary_llm_api_key: str       # å¯é€‰ï¼Œä¸å¡«å¤ç”¨ llm_api_key
  summary_llm_base_url: str      # å¯é€‰ï¼Œä¸å¡«å¤ç”¨ llm_base_url
  summary_llm_model: str         # å¯é€‰ï¼Œä¸å¡«å¤ç”¨ llm_model

  # â€”â€” æœåŠ¡ â€”â€”
  port: int                      # Railway è‡ªåŠ¨æ³¨å…¥ï¼Œé»˜è®¤ 8000

éªŒè¯é€»è¾‘:
  å¯åŠ¨æ—¶æ£€æŸ¥å¿…å¡«é¡¹ï¼Œç¼ºå¤±åˆ™æŠ›å‡ºæ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
  è‡ªåŠ¨æ£€æµ‹ summary_llm_base_url æ ¼å¼ï¼š
    å¦‚æœä»¥ /chat/completions ç»“å°¾ â†’ æ ‡è®°ä¸º"ç›´è¿æ¨¡å¼"ï¼ˆhttpx ç›´æ¥ POSTï¼‰
    å¦åˆ™ â†’ æ ‡è®°ä¸º"SDKæ¨¡å¼"ï¼ˆç”¨ OpenAI SDKï¼‰
```

---

### æ–‡ä»¶ Cï¼š`llm_client.py`

**èŒè´£**ï¼šå°è£…æ‰€æœ‰ LLM è°ƒç”¨

**âš ï¸ åŸºäºæºç çš„å…³é”®è®¾è®¡å˜æ›´**ï¼š

åŸé¡¹ç›®ä¸­ï¼Œä¸» LLM ç”¨ OpenAI SDKï¼Œä½†æ‘˜è¦ LLM ç”¨ httpx ç›´æ¥ POST åˆ°å®Œæ•´ URLã€‚æˆ‘ä»¬éœ€è¦åŒæ—¶æ”¯æŒä¸¤ç§æ¨¡å¼ã€‚

```
class LLMClient:

    åˆå§‹åŒ–:
      # ä¸» LLM: å§‹ç»ˆç”¨ OpenAI SDK
      self.main_client = AsyncOpenAI(
          api_key=config.llm_api_key,
          base_url=config.llm_base_url
      )
      self.main_model = config.llm_model

      # æ‘˜è¦ LLM: æ ¹æ® URL æ ¼å¼è‡ªåŠ¨é€‰æ‹©æ¨¡å¼
      if config.summary_llm_base_url ä»¥ "/chat/completions" ç»“å°¾:
          self.summary_mode = "direct"  # httpx ç›´è¿ï¼ˆå…¼å®¹åŸé¡¹ç›®é…ç½®ï¼‰
          self.summary_url = config.summary_llm_base_url
      else:
          self.summary_mode = "sdk"     # OpenAI SDK
          self.summary_client = AsyncOpenAI(...)

    async def chat(messages, role="main"|"summary", temperature=0.7, max_tokens=4000) -> str:
      """é€šç”¨å¯¹è¯æ¥å£"""
      IF role == "main":
          ç”¨ self.main_client è°ƒç”¨
      ELIF role == "summary":
          IF self.summary_mode == "sdk":
              ç”¨ self.summary_client è°ƒç”¨
          ELSE:  # direct mode
              ç”¨ httpx ç›´æ¥ POST

      é‡è¯•é€»è¾‘:
        æœ€å¤š 5 æ¬¡é‡è¯•
        æŒ‡æ•°é€€é¿ [1, 2, 4, 8, 16] ç§’
        æ£€æµ‹é‡å¤è¾“å‡ºï¼ˆå°¾éƒ¨50å­—ç¬¦å‡ºç°>5æ¬¡ï¼‰â†’ é‡è¯•
        æ£€æµ‹ä¸Šä¸‹æ–‡è¶…é™ â†’ æˆªæ–­å†…å®¹åé‡è¯•

    async def chat_json(messages, role="main", ...) -> dict:
      """è¿”å› JSON çš„å¯¹è¯"""
      åœ¨ system prompt ä¸­è¿½åŠ  "è¯·ä»¥ JSON æ ¼å¼è¿”å›ï¼Œä¸è¦åŒ…å«å…¶ä»–å†…å®¹"
      è°ƒç”¨ chat(...)
      ç”¨ json-repair è§£æï¼ˆå®¹é”™ï¼‰
      è¿”å› dict

    async def extract_info(content, info_to_extract, ...) -> str:
      """
      ä¸“é—¨ç”¨äº miro_read çš„ä¿¡æ¯æå–
      ä½¿ç”¨åŸé¡¹ç›®çš„ EXTRACT_INFO_PROMPT æ¨¡æ¿
      """
      prompt = EXTRACT_INFO_PROMPT.format(info_to_extract, content)
      è°ƒç”¨ chat(prompt, role="summary", ...)
      è¿”å›æå–ç»“æœ
```

**EXTRACT_INFO_PROMPT**ï¼ˆç›´æ¥ç§»æ¤è‡ªåŸé¡¹ç›®ï¼‰ï¼š

```
You are given a piece of content and the requirement of information to extract.
Your task is to extract the information specifically requested. Be precise and
focus exclusively on the requested information.

INFORMATION TO EXTRACT:
{}

INSTRUCTIONS:
1. Extract the information relevant to the focus above.
2. If the exact information is not found, extract the most closely related details.
3. Be specific and include exact details when available.
4. Clearly organize the extracted information for easy understanding.
5. Do not include general summaries or unrelated content.

CONTENT TO ANALYZE:
{}

EXTRACTED INFORMATION:
```

---

### æ–‡ä»¶ Dï¼š`mcp_tools/__init__.py`

ç©ºæ–‡ä»¶æˆ–ç»Ÿä¸€å¯¼å‡ºã€‚

---

### æ–‡ä»¶ Eï¼š`mcp_tools/miro_search.py`

**èŒè´£**ï¼šå°è£… Serper Google æœç´¢

**âš ï¸ åŸºäºæºç çš„ç²¾ç¡®å®ç°**ï¼š

```
async def do_miro_search(config, query, num_results, search_type, ctx) -> str:

    ctx.info("[MiroThinker] ğŸ” æ­£åœ¨æœç´¢: {query}")

    â”€â”€ æ­¥éª¤ 1: æ„é€  Serper è¯·æ±‚ â”€â”€

    url = f"{config.serper_base_url}/search"
    headers = {
        "X-API-KEY": config.serper_api_key,
        "Content-Type": "application/json"
    }
    payload = {
        "q": query.strip(),
        "gl": "us",        # å¯é€šè¿‡å‚æ•°æ§åˆ¶
        "hl": "en",         # å¯é€šè¿‡å‚æ•°æ§åˆ¶
        "num": num_results
    }

    # å¦‚æœæ˜¯æ–°é—»æœç´¢ï¼Œæ·»åŠ æ—¶é—´è¿‡æ»¤
    IF search_type == "news":
        payload["tbs"] = "qdr:w"  # è¿‡å»ä¸€å‘¨

    â”€â”€ æ­¥éª¤ 2: å‘é€è¯·æ±‚ï¼ˆå¸¦é‡è¯•ï¼‰â”€â”€

    é‡è¯•ç­–ç•¥: 3 æ¬¡, æŒ‡æ•°é€€é¿(4s-10s)
    ä½¿ç”¨ httpx.AsyncClient

    â”€â”€ æ­¥éª¤ 3: è§£æç»“æœ â”€â”€

    data = response.json()

    # è¿‡æ»¤ HuggingFace æ•°æ®é›†/ç©ºé—´ URLï¼ˆç§»æ¤è‡ªåŸé¡¹ç›®ï¼‰
    organic_results = []
    for item in data.get("organic", []):
        if "huggingface.co/datasets" in item.get("link", ""):
            continue
        if "huggingface.co/spaces" in item.get("link", ""):
            continue
        organic_results.append(item)

    # URL è§£ç ï¼ˆç§»æ¤è‡ªåŸé¡¹ç›®çš„ url_unquoteï¼‰
    organic_results = decode_http_urls_in_dict(organic_results)

    â”€â”€ æ­¥éª¤ 4: å¼•å·å»é™¤é‡è¯•ï¼ˆç§»æ¤è‡ªåŸé¡¹ç›®ï¼‰â”€â”€

    IF len(organic_results) == 0 AND '"' in query:
        å»æ‰å¼•å·åé‡æ–°æœç´¢

    â”€â”€ æ­¥éª¤ 5: æ ¼å¼åŒ–è¾“å‡º â”€â”€

    ## æœç´¢ç»“æœ: "{query}"
    å…±æ‰¾åˆ° {n} æ¡ç»“æœ

    1. **{title}**
       é“¾æ¥: {link}
       æ‘˜è¦: {snippet}
    2. ...

    ctx.info("[MiroThinker] âœ… æœç´¢å®Œæˆï¼Œæ‰¾åˆ° {n} æ¡ç»“æœ")

    è¿”å›æ ¼å¼åŒ–æ–‡æœ¬
```

**å·¥å…·å‚æ•°**ï¼š

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|:----:|--------|------|
| `query` | str | âœ… | â€” | æœç´¢å…³é”®è¯ |
| `num_results` | int | âŒ | 10 | è¿”å›æ¡æ•° |
| `search_type` | str | âŒ | "search" | "search" / "news" |

---

### æ–‡ä»¶ Fï¼š`mcp_tools/miro_read.py`

**èŒè´£**ï¼šç½‘é¡µå†…å®¹æå–ï¼Œå¸¦ Jina â†’ Python fallback â†’ LLM æå–çš„å®Œæ•´é“¾è·¯

**âš ï¸ åŸºäºæºç çš„ç²¾ç¡®å®ç°**ï¼š

```
async def do_miro_read(config, llm_client, url, query, ctx) -> str:

    ctx.info("[MiroThinker] ğŸ“„ æ­£åœ¨é˜…è¯»ç½‘é¡µ: {url}")

    â”€â”€ æ­¥éª¤ 1: ç”¨ Jina æŠ“å– â”€â”€

    # é¿å…é‡å¤å‰ç¼€ï¼ˆç§»æ¤è‡ªåŸé¡¹ç›®ï¼‰
    if url.startswith("https://r.jina.ai/") and url.count("http") >= 2:
        url = url[len("https://r.jina.ai/"):]

    jina_url = f"{config.jina_base_url}/{url}"
    headers = {"Authorization": f"Bearer {config.jina_api_key}"}

    ä½¿ç”¨ httpx.AsyncClient
    timeout = httpx.Timeout(None, connect=20, read=60)  # ä¸åŸé¡¹ç›®ä¸€è‡´
    é‡è¯•: [1, 2, 4, 8] ç§’

    ç‰¹æ®Šæ£€æµ‹:
      - InsufficientBalanceError â†’ è¿”å›ä½™é¢ä¸è¶³é”™è¯¯
      - ç©ºå†…å®¹ â†’ è¿›å…¥ fallback

    â”€â”€ æ­¥éª¤ 2: Python ç›´æ¥æŠ“å– fallbackï¼ˆç§»æ¤è‡ªåŸé¡¹ç›®ï¼‰â”€â”€

    IF Jina å¤±è´¥:
        ctx.warning("[MiroThinker] âš ï¸ Jina æŠ“å–å¤±è´¥ï¼Œå°è¯•ç›´æ¥è®¿é—®...")
        ä½¿ç”¨ httpx.AsyncClient ç›´æ¥ GET ç›®æ ‡ URL
        æ·»åŠ  User-Agent å¤´
        timeout = httpx.Timeout(None, connect=20, read=60)
        é‡è¯•: [1, 2, 4] ç§’

    â”€â”€ æ­¥éª¤ 3: å†…å®¹æˆªæ–­ â”€â”€

    max_chars = 409600  # ä¸åŸé¡¹ç›®ä¸€è‡´ (102400 * 4)
    content = raw_content[:max_chars]

    â”€â”€ æ­¥éª¤ 4: åˆ¤æ–­æ˜¯å¦éœ€è¦ LLM æå– â”€â”€

    IF len(content) <= 6000 AND query ä¸ºç©º:
        ç›´æ¥è¿”å› content
    ELSE:
        éœ€è¦ LLM æå–

    â”€â”€ æ­¥éª¤ 5: LLM ä¿¡æ¯æå–ï¼ˆä½¿ç”¨åŸé¡¹ç›®çš„ EXTRACT_INFO_PROMPTï¼‰â”€â”€

    ctx.info("[MiroThinker] ğŸ¤– æ­£åœ¨æå–å…³é”®ä¿¡æ¯...")

    info_to_extract = query if query else "ä¸»è¦å†…å®¹å’Œå…³é”®ä¿¡æ¯"

    extracted = await llm_client.extract_info(
        content=content,
        info_to_extract=info_to_extract
    )

    # å¦‚æœå†…å®¹è¶…å‡ºä¸Šä¸‹æ–‡é•¿åº¦ï¼Œä»å°¾éƒ¨æˆªæ–­åé‡è¯•ï¼ˆç§»æ¤è‡ªåŸé¡¹ç›®ï¼‰
    IF ä¸Šä¸‹æ–‡è¶…é™é”™è¯¯:
        content = content[:-40960] + "[...truncated]"
        é‡è¯•

    â”€â”€ æ­¥éª¤ 6: è¿”å› â”€â”€

    ctx.info("[MiroThinker] âœ… å†…å®¹æå–å®Œæˆ ({len} å­—)")

    ## ç½‘é¡µå†…å®¹: {url}
    {extracted æˆ– content}
```

---

### æ–‡ä»¶ Gï¼š`mcp_tools/miro_summarize.py`

**èŒè´£**ï¼šLLM æ–‡æœ¬æ•´ç†æ€»ç»“ï¼ˆæ­¤å·¥å…·é€»è¾‘è¾ƒç®€å•ï¼Œæœªå˜ï¼‰

```
async def do_miro_summarize(config, llm_client, content, instruction, ctx) -> str:

    ctx.info("[MiroThinker] ğŸ“ æ­£åœ¨æ•´ç†å†…å®¹ ({len} å­—)...")

    prompt æ„é€ ï¼ˆåŒå‰æ–¹æ¡ˆï¼‰
    è°ƒç”¨ llm_client.chat(role="summary")  # ç”¨æ‘˜è¦ LLMï¼ŒèŠ‚çœæˆæœ¬
    temperature=0.3

    ctx.info("[MiroThinker] âœ… å†…å®¹æ•´ç†å®Œæˆ")
    è¿”å›ç»“æœ
```

---

### æ–‡ä»¶ Hï¼š`mcp_tools/miro_research.py`

**èŒè´£**ï¼šå¤šè½®ç³»ç»Ÿæ€§ç ”ç©¶ï¼ˆé€»è¾‘åŒå‰æ–¹æ¡ˆï¼Œæ­¤å¤„ä»…æ ‡æ³¨åŸºäºæºç çš„è°ƒæ•´ï¼‰

**åŸºäºæºç çš„è°ƒæ•´ç‚¹**ï¼š

| è°ƒæ•´ | åŸæ–¹æ¡ˆ | æºç åˆ†æå |
|------|--------|-----------|
| æœç´¢åº•å±‚ | ç›´æ¥è°ƒç”¨ Serper | å¤ç”¨ `do_miro_search` å‡½æ•°ï¼Œä¿æŒè¡Œä¸ºä¸€è‡´ |
| é˜…è¯»åº•å±‚ | ç›´æ¥è°ƒç”¨ Jina | å¤ç”¨ `do_miro_read` å‡½æ•°ï¼ŒåŒ…å« fallback |
| LLM JSON è§£æ | json-repair | json-repair + é‡å¤æ£€æµ‹ï¼ˆå°¾éƒ¨50å­—ç¬¦ï¼‰ |
| è¶…æ—¶å¤„ç† | æ— ç‰¹æ®Šå¤„ç† | å‚è€ƒ manager.py çš„ 1200 ç§’è¶…æ—¶ |
| å†…å®¹æˆªæ–­ | ç®€å•æˆªæ–­ | å‚è€ƒåŸé¡¹ç›®çš„ `_remove_tool_result_from_messages`ï¼Œä¿ç•™æœ€è¿‘ N æ¡ |

**è¾“å‡ºæ ¼å¼**ï¼ˆClaude ä¸»å¯¼æ¨¡å¼ï¼Œè¿”å›ç´ æä¸å†™æŠ¥å‘Šï¼‰ï¼š

```
## è°ƒæŸ¥ç»“æœ: {question}

### å…³é”®å‘ç°
1. [å‘ç° 1] â€” æ¥æº: [é“¾æ¥]
2. [å‘ç° 2] â€” æ¥æº: [é“¾æ¥]
...

### å„ä¿¡æ¯æºè¯¦æƒ…
#### æ¥æº 1: {æ ‡é¢˜} ({url})
{æå–çš„å…³é”®å†…å®¹}

#### æ¥æº 2: ...

---
### æŸ¥è¯¢è¿‡ç¨‹ç»Ÿè®¡
- æœç´¢è½®æ•°: {n}/{max}
- æœç´¢å…³é”®è¯: {count} ä¸ª
- è®¿é—®ç½‘é¡µ: {count} ä¸ª
- æœ‰æ•ˆä¿¡æ¯æº: {count} ä¸ª

### ä¿¡æ¯æ¥æº
1. [æ ‡é¢˜](url)
2. ...
```

---

### æ–‡ä»¶ Iï¼š`mcp_tools/utils.py` ğŸ†•

**èŒè´£**ï¼šå·¥å…·å‡½æ•°ï¼Œç§»æ¤è‡ªåŸé¡¹ç›®çš„ `url_unquote.py`

```
def decode_http_urls_in_dict(data) -> dict/list:
    """
    é€’å½’éå† dict/listï¼Œå¯¹æ‰€æœ‰åŒ…å« http çš„å­—ç¬¦ä¸²å€¼åš URL è§£ç 
    ç§»æ¤è‡ª libs/miroflow-tools/src/miroflow_tools/mcp_servers/utils/url_unquote.py
    """
```

---

### æ–‡ä»¶ Jï¼š`requirements.txt`

**âš ï¸ åŸºäºæºç è°ƒæ•´ï¼šç”¨ httpx æ›¿ä»£ aiohttp**

```
fastmcp>=2.0.0          # MCP æœåŠ¡å™¨æ¡†æ¶ï¼ˆå« SSE æ”¯æŒï¼‰
mcp>=1.0.0              # MCP åè®®åŸºç¡€åº“
openai>=1.78.1          # ä¸» LLM è°ƒç”¨ï¼ˆOpenAI SDKï¼Œå†…éƒ¨ç”¨ httpxï¼‰
httpx>=0.27.0           # å¼‚æ­¥ HTTP å®¢æˆ·ç«¯ï¼ˆSerper/Jina/æ‘˜è¦LLM ç›´è¿ï¼‰
python-dotenv>=1.0.0    # åŠ è½½ .env æ–‡ä»¶
json-repair>=0.49.0     # ä¿®å¤ LLM ä¸è§„èŒƒ JSON
```

**å˜æ›´è¯´æ˜**ï¼š
- `aiohttp` â†’ `httpx`ï¼šä¸åŸé¡¹ç›®ä¿æŒä¸€è‡´ï¼Œä¸” openai SDK å·²è‡ªå¸¦ httpx ä¾èµ–
- æ€»è®¡ 6 ä¸ªåŒ…ï¼Œé¢„è®¡é•œåƒ < 200MB

---

### æ–‡ä»¶ Kï¼š`Dockerfile`

```
åŸºç¡€é•œåƒ: python:3.11-slim
å·¥ä½œç›®å½•: /app

æ­¥éª¤:
  1. åªå¤åˆ¶ apps/mcp-server/ ç›®å½•
  2. pip install -r requirements.txt
  3. æš´éœ² PORT
  4. CMD: python mcp_server.py

ä¼˜åŒ–:
  - ä¸å®‰è£…ä»»ä½• ML æ¡†æ¶
  - åˆ©ç”¨ Docker å±‚ç¼“å­˜ï¼ˆå…ˆå¤åˆ¶ requirements.txt å®‰è£…ä¾èµ–ï¼Œå†å¤åˆ¶ä»£ç ï¼‰
  - é¢„è®¡æ„å»º < 2 åˆ†é’Ÿï¼Œé•œåƒ < 200MB
```

---

### æ–‡ä»¶ Lï¼š`railway.toml`

```toml
[build]
builder = "dockerfile"
dockerfilePath = "apps/mcp-server/Dockerfile"

[deploy]
healthcheckPath = "/sse"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3
```

---

### æ–‡ä»¶ Mï¼š`.env.example`

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# MiroThinker MCP Server ç¯å¢ƒå˜é‡
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â”€â”€ å¿…å¡«: æœç´¢ â”€â”€
SERPER_API_KEY=your_serper_key_here
# SERPER_BASE_URL=https://google.serper.dev    # é€šå¸¸ä¸éœ€è¦æ”¹

# â”€â”€ å¿…å¡«: ç½‘é¡µæŠ“å– â”€â”€
JINA_API_KEY=your_jina_key_here
# JINA_BASE_URL=https://r.jina.ai              # é€šå¸¸ä¸éœ€è¦æ”¹

# â”€â”€ å¿…å¡«: ä¸» LLMï¼ˆç”¨äº miro_research çš„æ¨ç†ï¼‰â”€â”€
LLM_API_KEY=your_llm_api_key_here
LLM_BASE_URL=https://api.deepseek.com/v1       # OpenAI SDK æ ¼å¼ï¼ˆä¸å« /chat/completionsï¼‰
LLM_MODEL=deepseek-chat

# â”€â”€ å¯é€‰: æ‘˜è¦ LLMï¼ˆç”¨äº miro_read çš„å†…å®¹æå–ï¼‰â”€â”€
# ä¸å¡«åˆ™å¤ç”¨ä¸» LLMã€‚å»ºè®®ç”¨å°æ¨¡å‹èŠ‚çœæˆæœ¬
# æ”¯æŒä¸¤ç§ URL æ ¼å¼:
#   æ ¼å¼1 (OpenAI SDK): https://api.xxx.com/v1
#   æ ¼å¼2 (ç›´è¿ï¼Œå…¼å®¹åŸé¡¹ç›®): https://api.xxx.com/v1/chat/completions
# SUMMARY_LLM_API_KEY=
# SUMMARY_LLM_BASE_URL=
# SUMMARY_LLM_MODEL=
```

---

### æ–‡ä»¶ Nï¼š`README.md`

åŒ…å«ï¼š
1. é¡¹ç›®ç®€ä»‹
2. ä¸€é”®éƒ¨ç½²åˆ° Railway çš„è¯´æ˜
3. ç¯å¢ƒå˜é‡é…ç½®è¡¨
4. Claudian å®¢æˆ·ç«¯é…ç½®æ–¹æ³•ï¼ˆå«ç³»ç»Ÿæç¤ºæ¨¡æ¿ï¼‰
5. å››ä¸ªå·¥å…·çš„ä½¿ç”¨è¯´æ˜å’Œç¤ºä¾‹
6. LLM ä¾›åº”å•†åˆ‡æ¢æŒ‡å—
7. å¸¸è§é—®é¢˜

---

## å…­ã€å®æ—¶æ—¥å¿—æ¨é€ï¼ˆä¸å˜ï¼Œç®€è¦é‡è¿°ï¼‰

| æœºåˆ¶ | API | ç”¨é€” |
|------|-----|------|
| Logging | `ctx.info("[MiroThinker] ...")` | æ–‡æœ¬æ¶ˆæ¯ï¼ˆæœç´¢ä»€ä¹ˆ/é˜…è¯»ä»€ä¹ˆï¼‰ |
| Progress | `ctx.report_progress(current, total)` | è¿›åº¦æ•°å€¼ï¼ˆmiro_research çš„è½®æ¬¡ï¼‰ |

æ‰€æœ‰æ—¥å¿—ç»Ÿä¸€ `[MiroThinker]` å‰ç¼€ã€‚

é™çº§æ–¹æ¡ˆï¼šå¦‚æœ Claudian ä¸æ˜¾ç¤º Logging é€šçŸ¥ï¼Œå°†æ‰§è¡Œè¿‡ç¨‹æ‘˜è¦é™„åœ¨è¿”å›å€¼æœ«å°¾ã€‚

---

## ä¸ƒã€LLM ä¾›åº”å•†åˆ‡æ¢ï¼ˆä¸å˜ï¼Œç®€è¦é‡è¿°ï¼‰

åªéœ€æ”¹ Railway ç¯å¢ƒå˜é‡ï¼š

| æä¾›å•† | `LLM_BASE_URL` | `LLM_MODEL` |
|--------|----------------|-------------|
| DeepSeek | `https://api.deepseek.com/v1` | `deepseek-chat` |
| Kimi | `https://api.moonshot.cn/v1` | `moonshot-v1-128k` |
| MiniMax | `https://api.minimax.chat/v1` | `MiniMax-Text-01` |
| OpenAI | `https://api.openai.com/v1` | `gpt-4o` |

---

## å…«ã€Railway ç¯å¢ƒå˜é‡å®Œæ•´æ¸…å•

| å˜é‡å | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|:----:|--------|------|
| `SERPER_API_KEY` | âœ… | â€” | Serper Google æœç´¢ |
| `SERPER_BASE_URL` | âŒ | `https://google.serper.dev` | |
| `JINA_API_KEY` | âœ… | â€” | Jina ç½‘é¡µæŠ“å– |
| `JINA_BASE_URL` | âŒ | `https://r.jina.ai` | |
| `LLM_API_KEY` | âœ… | â€” | ä¸» LLM Key |
| `LLM_BASE_URL` | âœ… | â€” | ä¸» LLM åœ°å€ï¼ˆOpenAI SDK æ ¼å¼ï¼‰ |
| `LLM_MODEL` | âœ… | â€” | ä¸» LLM æ¨¡å‹å |
| `SUMMARY_LLM_API_KEY` | âŒ | å¤ç”¨ä¸» LLM | æ‘˜è¦ LLM Key |
| `SUMMARY_LLM_BASE_URL` | âŒ | å¤ç”¨ä¸» LLM | æ”¯æŒ SDK å’Œç›´è¿ä¸¤ç§æ ¼å¼ |
| `SUMMARY_LLM_MODEL` | âŒ | å¤ç”¨ä¸» LLM | æ‘˜è¦ LLM æ¨¡å‹å |
| `PORT` | âŒ | Railway æ³¨å…¥ | |

---

## ä¹ã€å®¢æˆ·ç«¯é…ç½®

### Claudian MCP è¿æ¥

```json
{
  "mcpServers": {
    "mirothinker": {
      "type": "sse",
      "url": "https://mirothinker-mcp.up.railway.app/sse"
    }
  }
}
```

### Claudian ç³»ç»Ÿæç¤º

```
å½“ä½ éœ€è¦æœç´¢äº’è”ç½‘ã€æŸ¥è¯ä¿¡æ¯æˆ–ç ”ç©¶æŸä¸ªè¯é¢˜æ—¶ï¼š
- âœ… ä½¿ç”¨ MiroThinker MCP çš„ miro_ ç³»åˆ—å·¥å…·
- âŒ ä¸è¦ä½¿ç”¨å†…ç½®çš„ WebSearch å’Œ WebFetchï¼ˆå½“å‰ç¯å¢ƒä¸å¯ç”¨ï¼‰

å·¥å…·æ¸…å•ï¼š
- miro_search: æœç´¢äº’è”ç½‘
- miro_read: è¯»å–ç½‘é¡µå†…å®¹
- miro_summarize: æ•´ç†æ€»ç»“ä¿¡æ¯
- miro_research: ç³»ç»Ÿæ€§ç ”ç©¶æŸä¸ªè¯é¢˜ï¼ˆå¤šè½®è‡ªåŠ¨æœç´¢å’Œæ•´ç†ï¼‰

ä½¿ç”¨ç­–ç•¥ç”±ä½ åˆ¤æ–­ï¼šç®€å•æŸ¥è¯¢ç”¨ miro_searchï¼Œçœ‹ç½‘é¡µç”¨ miro_readï¼Œ
æ•´ç†ä¿¡æ¯ç”¨ miro_summarizeï¼Œå¤æ‚è¯é¢˜ç”¨ miro_researchã€‚
```

---

## åã€å®æ–½æ­¥éª¤

```
Phase 1: ç¼–å†™ä»£ç ï¼ˆ14 ä¸ªæ–‡ä»¶ï¼‰
  Step 1   åˆ›å»º apps/mcp-server/ ç›®å½•ç»“æ„
  Step 2   ç¼–å†™ mcp_config.py
  Step 3   ç¼–å†™ llm_client.pyï¼ˆå« EXTRACT_INFO_PROMPTï¼‰
  Step 4   ç¼–å†™ mcp_tools/utils.pyï¼ˆURL è§£ç ï¼‰
  Step 5   ç¼–å†™ mcp_tools/miro_search.py
  Step 6   ç¼–å†™ mcp_tools/miro_read.pyï¼ˆå« Python fallbackï¼‰
  Step 7   ç¼–å†™ mcp_tools/miro_summarize.py
  Step 8   ç¼–å†™ mcp_tools/miro_research.py
  Step 9   ç¼–å†™ mcp_server.py
  Step 10  ç¼–å†™ requirements.txt / .env.example / README.md

Phase 2: æœ¬åœ°æµ‹è¯•
  Step 11  åˆ›å»º .env å¡«å…¥çœŸå® API Keys
  Step 12  pip install -r requirements.txt
  Step 13  python mcp_server.py
  Step 14  ç”¨ MCP Inspector æµ‹è¯• 4 ä¸ªå·¥å…·
  Step 15  éªŒè¯æ—¥å¿—æ¨é€å’Œè¿›åº¦é€šçŸ¥

Phase 3: å®¹å™¨åŒ– + éƒ¨ç½²
  Step 16  ç¼–å†™ Dockerfile + railway.toml
  Step 17  æœ¬åœ° docker build & run æµ‹è¯•
  Step 18  æ¨é€ GitHub â†’ Railway è‡ªåŠ¨éƒ¨ç½²
  Step 19  é…ç½® Railway ç¯å¢ƒå˜é‡
  Step 20  ç¡®è®¤æœåŠ¡å­˜æ´»

Phase 4: å®¢æˆ·ç«¯è”è°ƒ
  Step 21  Claudian é…ç½® MCP Server URL
  Step 22  é…ç½®ç³»ç»Ÿæç¤º
  Step 23  é€ä¸ªæµ‹è¯• 4 ä¸ªå·¥å…·
  Step 24  ç«¯åˆ°ç«¯éªŒæ”¶
```

---

## åä¸€ã€é£é™©æ¸…å•

| # | é£é™© | æ¦‚ç‡ | åº”å¯¹ |
|---|------|------|------|
| 1 | Claudian ä¸æ”¯æŒ SSE | ä½ | å¤‡é€‰ HTTPâ†’stdio è½¬æ¥ |
| 2 | Claudian ä¸æ˜¾ç¤º Logging é€šçŸ¥ | ä¸­ | æ—¥å¿—æ‘˜è¦é™„åœ¨è¿”å›å€¼æœ«å°¾ |
| 3 | Claude ä»ä¼˜å…ˆè°ƒå†…ç½® WebSearch | ä¸­ | ç³»ç»Ÿæç¤ºæ˜ç¡®ç¦ç”¨ + å·¥å…·æè¿°å¼•å¯¼ |
| 4 | `miro_research` è¶…æ—¶ | ä¸­ | é»˜è®¤ 5 è½®ï¼Œæ¯è½® 3 URLï¼ŒSSE é•¿è¿æ¥ |
| 5 | LLM JSON ä¸è§„èŒƒ | ä¸­ | json-repair + é‡å¤æ£€æµ‹ + fallback |
| 6 | Jina æŠ“å–å¤±è´¥ | ä¸­ | Python httpx ç›´æ¥æŠ“å– fallback |
| 7 | SUMMARY_LLM_BASE_URL æ ¼å¼ä¸ä¸€è‡´ | ä¸­ | è‡ªåŠ¨æ£€æµ‹ SDK/ç›´è¿æ¨¡å¼ |
| 8 | Railway å†·å¯åŠ¨æ…¢ | ä¸­ | ç²¾ç®€é•œåƒ < 200MB |

---

**æ–¹æ¡ˆå®Œæ•´ã€‚ç¡®è®¤åæˆ‘é€ä¸ªè¾“å‡º 14 ä¸ªæ–‡ä»¶çš„å®Œæ•´å®ç°ä»£ç ã€‚**